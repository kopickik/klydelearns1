{"dependencies":[{"name":"../Observable","loc":{"line":7,"column":27}},{"name":"../Notification","loc":{"line":8,"column":29}},{"name":"./ColdObservable","loc":{"line":9,"column":31}},{"name":"./HotObservable","loc":{"line":10,"column":30}},{"name":"./SubscriptionLog","loc":{"line":11,"column":32}},{"name":"../scheduler/VirtualTimeScheduler","loc":{"line":12,"column":37}}],"generated":{"js":"\"use strict\";var e=this&&this.__extends||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);function i(){this.constructor=e}e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)},r=require(\"../Observable\"),t=require(\"../Notification\"),i=require(\"./ColdObservable\"),a=require(\"./HotObservable\"),o=require(\"./SubscriptionLog\"),n=require(\"../scheduler/VirtualTimeScheduler\"),s=750,c=function(c){e(u,c);function u(e){c.call(this,n.VirtualAction,s),this.assertDeepEqual=e,this.hotObservables=[],this.coldObservables=[],this.flushTests=[]}return u.prototype.createTime=function(e){var r=e.indexOf(\"|\");if(-1===r)throw new Error('marble diagram for time should have a completion marker \"|\"');return r*u.frameTimeFactor},u.prototype.createColdObservable=function(e,r,t){if(-1!==e.indexOf(\"^\"))throw new Error('cold observable cannot have subscription offset \"^\"');if(-1!==e.indexOf(\"!\"))throw new Error('cold observable cannot have unsubscription marker \"!\"');var a=u.parseMarbles(e,r,t),o=new i.ColdObservable(a,this);return this.coldObservables.push(o),o},u.prototype.createHotObservable=function(e,r,t){if(-1!==e.indexOf(\"!\"))throw new Error('hot observable cannot have unsubscription marker \"!\"');var i=u.parseMarbles(e,r,t),o=new a.HotObservable(i,this);return this.hotObservables.push(o),o},u.prototype.materializeInnerObservable=function(e,r){var i=this,a=[];return e.subscribe(function(e){a.push({frame:i.frame-r,notification:t.Notification.createNext(e)})},function(e){a.push({frame:i.frame-r,notification:t.Notification.createError(e)})},function(){a.push({frame:i.frame-r,notification:t.Notification.createComplete()})}),a},u.prototype.expectObservable=function(e,i){var a=this;void 0===i&&(i=null);var o,n=[],s={actual:n,ready:!1},c=u.parseMarblesAsSubscriptions(i).unsubscribedFrame;return this.schedule(function(){o=e.subscribe(function(e){var i=e;e instanceof r.Observable&&(i=a.materializeInnerObservable(i,a.frame)),n.push({frame:a.frame,notification:t.Notification.createNext(i)})},function(e){n.push({frame:a.frame,notification:t.Notification.createError(e)})},function(){n.push({frame:a.frame,notification:t.Notification.createComplete()})})},0),c!==Number.POSITIVE_INFINITY&&this.schedule(function(){return o.unsubscribe()},c),this.flushTests.push(s),{toBe:function(e,r,t){s.ready=!0,s.expected=u.parseMarbles(e,r,t,!0)}}},u.prototype.expectSubscriptions=function(e){var r={actual:e,ready:!1};return this.flushTests.push(r),{toBe:function(e){var t=\"string\"==typeof e?[e]:e;r.ready=!0,r.expected=t.map(function(e){return u.parseMarblesAsSubscriptions(e)})}}},u.prototype.flush=function(){for(var e=this.hotObservables;e.length>0;)e.shift().setup();c.prototype.flush.call(this);for(var r=this.flushTests.filter(function(e){return e.ready});r.length>0;){var t=r.shift();this.assertDeepEqual(t.actual,t.expected)}},u.parseMarblesAsSubscriptions=function(e){if(\"string\"!=typeof e)return new o.SubscriptionLog(Number.POSITIVE_INFINITY);for(var r=e.length,t=-1,i=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,n=0;n<r;n++){var s=n*this.frameTimeFactor,c=e[n];switch(c){case\"-\":case\" \":break;case\"(\":t=s;break;case\")\":t=-1;break;case\"^\":if(i!==Number.POSITIVE_INFINITY)throw new Error(\"found a second subscription point '^' in a subscription marble diagram. There can only be one.\");i=t>-1?t:s;break;case\"!\":if(a!==Number.POSITIVE_INFINITY)throw new Error(\"found a second subscription point '^' in a subscription marble diagram. There can only be one.\");a=t>-1?t:s;break;default:throw new Error(\"there can only be '^' and '!' markers in a subscription marble diagram. Found instead '\"+c+\"'.\")}}return a<0?new o.SubscriptionLog(i):new o.SubscriptionLog(i,a)},u.parseMarbles=function(e,r,a,o){if(void 0===o&&(o=!1),-1!==e.indexOf(\"!\"))throw new Error('conventional marble diagrams cannot have the unsubscription marker \"!\"');for(var n=e.length,s=[],c=e.indexOf(\"^\"),u=-1===c?0:c*-this.frameTimeFactor,f=\"object\"!=typeof r?function(e){return e}:function(e){return o&&r[e]instanceof i.ColdObservable?r[e].messages:r[e]},b=-1,l=0;l<n;l++){var h=l*this.frameTimeFactor+u,p=void 0,m=e[l];switch(m){case\"-\":case\" \":break;case\"(\":b=h;break;case\")\":b=-1;break;case\"|\":p=t.Notification.createComplete();break;case\"^\":break;case\"#\":p=t.Notification.createError(a||\"error\");break;default:p=t.Notification.createNext(f(m))}p&&s.push({frame:b>-1?b:h,notification:p})}return s},u}(n.VirtualTimeScheduler);exports.TestScheduler=c;"},"hash":"474311648881144239d14e960c2760ca"}